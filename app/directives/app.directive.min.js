app.directive("autocompleteCombobox",["$parse","$http","$sce","$timeout","savevalueService",function(e,t,h,r,s){return{restrict:"EA",scope:{id:"@id",placeholder:"@placeholder",selectedObject:"=selectedobject",titleField:"@titlefield",class:"@inputclass",localData:"=localdata",matchClass:"@matchclass"},template:'<div class="autocomplete-holder"><input ng-model="searchStr" type="text" placeholder="{{placeholder}}" class="{{class}}" onmouseup="this.select();" autocomplete="off"/><div class="autocomplete-dropdown" ng-if="showDropdown"><div class="autocomplete-noresult" ng-show="!results || results.length == 0">Nema rezultata pretrage </div><div class="autocomplete-row" ng-repeat="result in results | limitTo:6" ng-mousedown="selectResult(result)" ng-mouseover="hoverRow()" ng-class="{\'autocomplete-selected-row\': $index == currentIndex}"><div class="autocomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div></div></div></div>',link:function(i,e,t){i.lastSearchTerm=null,i.currentIndex=null,i.searchStr=null,isNewSearchNeeded=function(e,t){return 1<=e.length&&e!=t},i.processResults=function(e,t){if(e&&0<e.length){i.results=[];for(var r=["name","city"],s=0;s<e.length;s++){for(var l=[],a=0;a<r.length;a++)"city"==r[a]?l.push(e[s].address[r[a]]):l.push(e[s][r[a]]);var n=l.join(", ");if(i.matchClass){var c=new RegExp(t,"i"),o=n.match(c)[0];n=h.trustAsHtml(n.replace(c,o))}var u={title:n,rating:e[s].rating,restaurant:e[s]};i.results[i.results.length]=u,i.results.sort(function(e,t){return e.rating<t.rating?1:t.rating<e.rating?-1:0})}}else i.results=[]},i.searchTimerComplete=function(e){if(1<=e.length&&i.localData){var t="name, city";t=t.split(",");for(var r=[],s=0;s<i.localData.length;s++){for(var l=!1,a=0;a<t.length;a++)l=l||"string"==typeof i.localData[s][t[a]]&&"string"==typeof e&&0<=i.localData[s][t[a]].toLowerCase().indexOf(e.toLowerCase());l&&(r[r.length]=i.localData[s])}i.processResults(r,e)}},i.hoverRow=function(e){i.currentIndex=e},i.keyPressed=function(e){38!=e.which&&40!=e.which&&13!=e.which?i.searchStr&&""!=i.searchStr?isNewSearchNeeded(i.searchStr,i.lastSearchTerm)&&(i.lastSearchTerm=i.searchStr,i.showDropdown=!0,i.currentIndex=-1,i.results=[],r(function(){i.searchTimerComplete(i.searchStr)},300)):(i.showDropdown=!1,i.lastSearchTerm=null):e.preventDefault()},i.selectResult=function(e){i.matchClass&&(e.title=e.title),i.searchStr=i.lastSearchTerm=e.title,i.selectedObject=e,s.set(i.selectedObject),i.showDropdown=!1,i.results=[]},e.find("input").on("keyup",i.keyPressed),e.on("keyup",function(e){40===e.which?(i.results&&i.currentIndex+1<i.results.length&&5!=i.currentIndex&&(i.currentIndex++,i.$apply(),e.preventDefault,e.stopPropagation()),i.$apply()):38==e.which?1<=i.currentIndex&&(i.currentIndex--,i.$apply(),e.preventDefault,e.stopPropagation()):13==e.which?(i.results&&0<=i.currentIndex&&i.currentIndex<i.results.length?i.selectResult(i.results[i.currentIndex]):i.results=[],i.$apply(),e.preventDefault,e.stopPropagation()):27==e.which?(i.results=[],i.showDropdown=!1,i.$apply()):8==e.which&&(i.selectedObject=null,i.$apply())})}}}]);